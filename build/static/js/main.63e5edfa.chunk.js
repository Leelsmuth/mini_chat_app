(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{132:function(e,a,n){e.exports=n(352)},339:function(e,a,n){},352:function(e,a,n){"use strict";n.r(a);var r=n(2),t=n.n(r),i=n(21),s=n.n(i),c=n(79),u=n(22),l=n(28),m=n(128),o=n(129),v=n(0),d=n(130),f=n(23),p=n.n(f),b=n(34),g=n(59),M=n(33),O=n(27),y=n(24),j=n(58),h=n.n(j),E=function(e){var a=e.users,n=e.email,i=e.name,s=Object(r.useCallback)(function(a,n){e.selectedMail(a,n)}),c=Object(r.useCallback)(function(){e.deleteUser(n)});return t.a.createElement("div",{className:"user-welcome",style:e.style},t.a.createElement("div",{className:"user-heading"},t.a.createElement("p",null,"Hello, ",i),t.a.createElement(h.a,{className:"leave",size:"small",variant:"outlined",onClick:c},"Leave Chat?")),t.a.createElement("div",{className:"select-user"},a.map(function(e){return e.email!==n?t.a.createElement("div",{key:e.id,className:"users",onClick:function(){return s(e.email,e.name)}},e.name):""})))},w=n(25),N=n.n(w),S=n(45),k=n.n(S),$=n(126),q=n.n($);function U(){var e=Object(y.a)(["\n  subscription($receiverMail: String!) {\n    userTyping(receiverMail: $receiverMail)\n  }\n"]);return U=function(){return e},e}function x(){var e=Object(y.a)(["\n  subscription($receiverMail: String!) {\n    newMessage(receiverMail: $receiverMail) {\n      message\n      senderMail\n      receiverMail\n      id\n      timestamp\n      users {\n        name\n        email\n      }\n    }\n  }\n"]);return x=function(){return e},e}function T(){var e=Object(y.a)(["\n  mutation($email: String!, $receiverMail: String!) {\n    userTyping(email: $email, receiverMail: $receiverMail)\n  }\n"]);return T=function(){return e},e}function C(){var e=Object(y.a)(["\n  mutation(\n    $message: String!\n    $senderMail: String!\n    $receiverMail: String!\n    $timestamp: Float!\n  ) {\n    createMessage(\n      message: $message\n      senderMail: $senderMail\n      receiverMail: $receiverMail\n      timestamp: $timestamp\n    ) {\n      message\n      senderMail\n      receiverMail\n      id\n      timestamp\n      users {\n        name\n        email\n      }\n    }\n  }\n"]);return C=function(){return e},e}function Q(){var e=Object(y.a)(["\n  query {\n    messages {\n      id\n      message\n      senderMail\n      receiverMail\n      timestamp\n      users {\n        name\n        email\n      }\n    }\n  }\n"]);return Q=function(){return e},e}var D=N()(Q()),I=N()(C()),J=N()(T()),L=N()(x()),V=N()(U()),z=Object(u.compose)(Object(u.graphql)(D,{name:"message"}),Object(u.graphql)(I,{name:"createMessage"}),Object(u.graphql)(J,{name:"userTyping"}))(function(e){var a=Object(r.useRef)(null),n=Object(r.useState)(""),i=Object(O.a)(n,2),s=i[0],c=i[1],u=Object(r.useState)(""),l=Object(O.a)(u,2),m=l[0],o=l[1],v=Object(r.useState)(null),d=Object(O.a)(v,2),f=d[0],y=d[1];Object(r.useEffect)(function(){e.message.subscribeToMore({document:L,variables:{receiverMail:e.email},updateQuery:function(e,a){var n=a.subscriptionData;if(!n.data)return e;var r=n.data.newMessage;return e.messages.find(function(e){return e.id===r.id})?e:Object(M.a)({},e,{messages:[].concat(Object(g.a)(e.messages),[r])})}}),e.message.subscribeToMore({document:V,variables:{receiverMail:e.email},updateQuery:function(e,a){var n=a.subscriptionData;if(!n.data)return e;var r=n.data.userTyping;o(r)}}),a.current&&j()});var j=function(){a.current.scrollIntoView()},h=function(){var a=Object(b.a)(p.a.mark(function a(n){var r,t,i;return p.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return c(n.target.value),r=e.email,t=e.receiverMail,a.next=4,e.userTyping({variables:{email:r,receiverMail:t}});case 4:i=function(){var a=Object(b.a)(p.a.mark(function a(){return p.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,e.userTyping({variables:{email:"email",receiverMail:t}});case 2:case"end":return a.stop()}},a)}));return function(){return a.apply(this,arguments)}}(),clearTimeout(f),y(setTimeout(i,2e3));case 7:case"end":return a.stop()}},a)}));return function(e){return a.apply(this,arguments)}}(),E=function(){var a=Object(b.a)(p.a.mark(function a(n,r,t){var i;return p.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(c(""),n.preventDefault(),i=e.receiverMail,r.length){a.next=5;break}return a.abrupt("return",null);case 5:return a.next=7,e.createMessage({variables:{receiverMail:i,senderMail:t,message:r,timestamp:Date.now()},update:function(e,a){var n=a.data.createMessage,r=e.readQuery({query:D});r.messages.push(n),e.writeQuery({query:D,data:r})}});case 7:return a.next=9,e.userTyping({variables:{email:"email",receiverMail:i}});case 9:case"end":return a.stop()}},a)}));return function(e,n,r){return a.apply(this,arguments)}}(),w=e.message,N=w.error,S=w.loading,$=w.messages,U=e.email,x=e.receiverMail,T=e.receiverName,C=e.userLeft;return N||S?null:t.a.createElement("div",{className:"personal-chat",style:e.style},t.a.createElement("div",{className:"chats-header"},t.a.createElement("div",{className:"back-button",onClick:function(){e.setStyle()}},t.a.createElement("div",{className:"bar1"}),t.a.createElement("div",{className:"bar2"}),t.a.createElement("div",{className:"bar3"})),t.a.createElement("div",{className:"user-typing"},m&&m===x?"".concat(T," is typing"):T)),t.a.createElement("div",{className:"all-messages"},$.map(function(e){return e.senderMail===U&&e.receiverMail===x||e.senderMail===x&&e.receiverMail===U?t.a.createElement("div",{key:e.id,className:e.users.map(function(e){return e.email===x?"receiver":"sender"})},t.a.createElement("div",{className:"sender-name"},e.users.map(function(e){return e.name})),e.message," ",t.a.createElement("span",{className:"time"}," ",q()(e.timestamp).fromNow())):""}),C&&C===x?t.a.createElement("div",null,T," has left the chat. "):null),x&&T&&!C?t.a.createElement("form",{onSubmit:function(e){return E(e,s,U)},ref:a,className:"chat-box"},t.a.createElement(k.a,{style:{margin:10},placeholder:"Say something to "+T,fullWidth:!0,name:"message",value:s,onChange:h,margin:"normal",variant:"outlined"})):t.a.createElement("div",{className:"select-message"},"Select a logged in user from the left panel"))}),A=n(57),B=n(78),F=n.n(B),H=n(80),P=n.n(H),R=function(e){var a=Object(r.useState)({name:"",email:""}),n=Object(O.a)(a,2),i=n[0],s=n[1],c=Object(r.useState)(""),u=Object(O.a)(c,2),l=u[0],m=u[1],o=function(e){s(Object(M.a)({},i,Object(A.a)({},e.target.name,e.target.value)))},v=i.name,d=i.email;return t.a.createElement(F.a,{elevation:3,className:"paper"},"User Details",t.a.createElement(k.a,{required:!0,id:"outlined-name",label:"Name",name:"name",value:v,onChange:o,variant:"outlined",style:{margin:10}}),t.a.createElement(k.a,{required:!0,id:"outlined-email-input",type:"email",label:"Email",name:"email",value:d,onChange:o,variant:"outlined",className:"text-area",style:{margin:10}}),t.a.createElement(h.a,{variant:"contained",onClick:function(){var a=i.name,n=i.email,r=e.users.some(function(e){return e.email===n});a.length||m("Name is required"),P.a.isEmail(n)||m("Valid email is required"),r&&m("Email already in use"),a.length&&P.a.isEmail(n)&&!r&&(m(""),e.createUser(n,a),localStorage.token=JSON.stringify(i))},style:{margin:15}},"Enter Chat"),t.a.createElement("div",null,l))};function W(){var e=Object(y.a)(["\n  subscription {\n    oldUser\n  }\n"]);return W=function(){return e},e}function G(){var e=Object(y.a)(["\n  subscription {\n    newUser {\n      name\n      email\n      id\n      messages {\n        message\n        senderMail\n        receiverMail\n        timestamp\n      }\n    }\n  }\n"]);return G=function(){return e},e}function K(){var e=Object(y.a)(["\n  mutation($email: String!) {\n    deleteUser(email: $email)\n  }\n"]);return K=function(){return e},e}function X(){var e=Object(y.a)(["\n  mutation($name: String!, $email: String!) {\n    createUser(name: $name, email: $email) {\n      name\n      email\n      id\n      messages {\n        message\n        senderMail\n        receiverMail\n      }\n    }\n  }\n"]);return X=function(){return e},e}function Y(){var e=Object(y.a)(["\n  query {\n    users {\n      id\n      name\n      email\n      messages {\n        message\n        senderMail\n        receiverMail\n      }\n    }\n  }\n"]);return Y=function(){return e},e}var Z=N()(Y()),_=N()(X()),ee=N()(K()),ae=N()(G()),ne=N()(W()),re=Object(u.compose)(Object(u.graphql)(Z),Object(u.graphql)(_,{name:"createUser"}),Object(u.graphql)(ee,{name:"deleteUser"}))(function(e){var a=localStorage.getItem("token")&&JSON.parse(localStorage.getItem("token"))||{},n=Object(r.useState)({receiverMail:"",receiverName:""}),i=Object(O.a)(n,2),s=i[0],c=i[1],u=Object(r.useState)(""),l=Object(O.a)(u,2),m=l[0],o=l[1],v=Object(r.useState)(!1),d=Object(O.a)(v,2),f=d[0],y=d[1];Object(r.useEffect)(function(){var a=e.data.subscribeToMore;a({document:ae,updateQuery:function(e,a){var n=a.subscriptionData;if(!n.data)return e;var r=n.data.newUser;return e.users.find(function(e){return e.id===r.id})?e:Object(M.a)({},e,{users:[].concat(Object(g.a)(e.users),[r])})}}),a({document:ne,updateQuery:function(e,a){var n=a.subscriptionData;if(!n.data)return e;var r=n.data.oldUser;if(e.users.some(function(e){return e.email===r})){var t=e.users.filter(function(e){return e.email!==r});return e.users=t,e}return o(r),e}})},[e.data]);var j=function(){var a=Object(b.a)(p.a.mark(function a(n,r){return p.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,e.createUser({variables:{email:n,name:r},update:function(e,a){var n=a.data.createUser,r=e.readQuery({query:Z});r.users.find(function(e){return e.id===n.id})||r.users.push(n),e.writeQuery({query:Z,data:r})}});case 2:case"end":return a.stop()}},a)}));return function(e,n){return a.apply(this,arguments)}}(),h=function(){var a=Object(b.a)(p.a.mark(function a(n){return p.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return localStorage.removeItem("token"),a.next=3,e.deleteUser({variables:{email:n},update:function(e){var a=e.readQuery({query:Z});a.users=a.users.filter(function(e){return e.email!==n}),e.writeQuery({query:Z,data:a})}});case 3:case"end":return a.stop()}},a)}));return function(e){return a.apply(this,arguments)}}(),w=s.receiverMail,N=s.receiverName,S=e.data,k=S.users,$=S.error;return S.loading||$?null:localStorage.getItem("token")?t.a.createElement("div",{className:"chat-page"},t.a.createElement(E,{style:{display:f?"none":"block"},users:k,email:a.email,name:a.name,selectedMail:function(e,a){c(function(n){return Object(M.a)({},n,{receiverMail:e,receiverName:a})}),y(!f)},deleteUser:h}),t.a.createElement(z,{style:{display:f?"block":"none"},email:a.email,receiverMail:w,receiverName:N,userLeft:m,name:a.name,setStyle:function(){y(!f)}})):t.a.createElement(R,{users:k,createUser:j})}),te=(n(339),new m.a({uri:"https://server.lukaschiama.now.sh/"})),ie=new o.a({uri:"wss://server.lukaschiama.now.sh/",options:{reconnect:!0}}),se=Object(l.d)(function(e){var a=e.query,n=Object(v.k)(a),r=n.kind,t=n.operation;return"OperationDefinition"===r&&"subscription"===t},ie,te),ce=new c.default({link:se,cache:new d.a});s.a.render(t.a.createElement(u.ApolloProvider,{client:ce},t.a.createElement(re,null)),document.getElementById("root"))}},[[132,1,2]]]);
//# sourceMappingURL=main.63e5edfa.chunk.js.map